<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>景河泉抵扣卡查询</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft YaHei", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    .card {
      max-width: 520px;
      margin: 20px auto 16px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 18px 16px 22px;
    }
    h1 {
      font-size: 20px;
      text-align: center;
      margin: 0 0 8px;
    }
    .card-id {
      font-size: 13px;
      color: #666;
      text-align: center;
      word-break: break-all;
      margin-bottom: 10px;
    }
    .field {
      display: flex;
      justify-content: space-between;
      font-size: 15px;
      margin: 6px 0;
    }
    .label {
      color: #666;
    }
    .value {
      font-weight: 500;
      color: #222;
    }
    .status {
      font-weight: 600;
    }
    .status[data-status="未激活"] {
      color: #ff9800;
    }
    .status[data-status="已用完"],
    .status[data-status="作废"] {
      color: #f44336;
    }
    .status[data-status="正常"] {
      color: #4caf50;
    }
    .rules {
      max-width: 520px;
      margin: 0 auto 20px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      padding: 14px 14px 16px;
      font-size: 13px;
      line-height: 1.55;
      color: #333;
    }
    .rules h2 {
      font-size: 15px;
      margin: 0 0 6px;
      font-weight: 600;
    }
    .rules p {
      margin: 4px 0;
    }
    .rules .item-title {
      font-weight: 600;
    }
    .rules ul {
      padding-left: 18px;
      margin: 4px 0;
    }
    .rules li {
      margin: 2px 0;
    }
    .error, .loading {
      max-width: 520px;
      margin: 40px auto;
      text-align: center;
      color: #666;
      font-size: 15px;
      padding: 0 16px;
    }
    .error {
      color: #f44336;
    }
    .footer {
      text-align: center;
      font-size: 11px;
      color: #999;
      margin-bottom: 14px;
    }
  </style>
</head>
<body>

<div id="app" class="loading">正在加载卡片信息...</div>

<div class="rules">
  <h2>景河泉抵扣卡使用规则</h2>

  <p class="item-title">1. 每日限使用一次抵扣额度。</p>
  <p>每位持卡人每天仅限使用一次抵扣额度，当日未使用不可累积顺延。</p>

  <p class="item-title">2. 基础抵扣额度为 20 元/天。</p>
  <p>任意消费均可使用当日基础抵扣 20 元。</p>

  <p class="item-title">3. 满额部分自动叠加额外抵扣。</p>
  <p>在基础抵扣 20 元的基础上，单笔消费达到以下金额，可享受当日更高抵扣：</p>
  <ul>
    <li>单笔满 60 元 → 当日抵扣 40 元（基础 20 + 额外 20）</li>
    <li>单笔满 100 元 → 当日抵扣 50 元（基础 20 + 额外 30）</li>
    <li>单笔满 150 元 → 当日抵扣 70 元（基础 20 + 额外 50）</li>
  </ul>

  <p class="item-title">4. 抵扣金额不可兑换现金，不找零，不挂失。</p>
</div>

<div class="footer">
  本卡仅限景河泉店内酒水消费抵扣，具体解释以店内公示为准。
</div>

<script>
  async function main() {
    const app = document.getElementById('app');

    const params = new URLSearchParams(window.location.search);
    const cardId = params.get('id');

    if (!cardId) {
      app.className = 'error';
      app.textContent = '链接缺少卡号参数：请使用正确的二维码或链接（?id=卡号）。';
      return;
    }

    try {
      const res = await fetch('cards.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('无法加载卡片数据（' + res.status + '）');

      const cards = await res.json();
      const card = cards.find(c => c.card_id === cardId);

      if (!card) {
        app.className = 'error';
        app.textContent = '未找到该卡号：' + cardId + '，请联系店家核对。';
        return;
      }

      app.className = 'card';
      app.innerHTML = `
        <h1>景河泉抵扣卡查询</h1>
        <div class="card-id">卡号：${card.card_id}</div>

        <div class="field">
          <div class="label">面额</div>
          <div class="value">${card.amount} 元</div>
        </div>
        <div class="field">
          <div class="label">发行日期</div>
          <div class="value">${card.date}</div>
        </div>
        <div class="field">
          <div class="label">初始金额</div>
          <div class="value">${card.initial} 元</div>
        </div>
        <div class="field">
          <div class="label">当前余额</div>
          <div class="value">${card.balance} 元</div>
        </div>
        <div class="field">
          <div class="label">状态</div>
          <div class="value status" data-status="${card.status}">${card.status}</div>
        </div>
        <div class="field">
          <div class="label">备注</div>
          <div class="value">${card.note || '—'}</div>
        </div>
      `;
    } catch (err) {
      console.error(err);
      app.className = 'error';
      app.textContent = '查询出错：' + err.message;
    }
  }

  main();
</script>
</body>
</html>

