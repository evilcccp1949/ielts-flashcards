<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>景河泉抵扣卡查询</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC",
                   "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    .card {
      max-width: 480px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      padding: 20px 18px 18px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    h1 {
      font-size: 20px;
      margin: 0 0 8px;
      text-align: center;
    }
    .id {
      font-size: 12px;
      color: #888;
      text-align: center;
      word-break: break-all;
      margin-bottom: 12px;
    }
    .amount {
      font-size: 28px;
      font-weight: 700;
      text-align: center;
      margin: 12px 0 4px;
    }
    .amount small {
      font-size: 14px;
      font-weight: 400;
      margin-left: 4px;
    }
    .status {
      text-align: center;
      margin-bottom: 16px;
      font-size: 14px;
    }
    .status span {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: #fff;
    }
    .status--unused span { background: #2ecc71; }
    .status--used span { background: #e74c3c; }
    .status--other span { background: #f39c12; }

    .info-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin: 4px 0;
    }
    .label { color: #666; }
    .value { font-weight: 500; }

    .note {
      margin-top: 10px;
      font-size: 13px;
      color: #666;
    }

    .error {
      max-width: 480px;
      margin: 40px auto;
      text-align: center;
      color: #e74c3c;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div id="app"></div>

<script>
  // 1. 取 URL 里的 id
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const app = document.getElementById("app");

  if (!id) {
    app.innerHTML = '<div class="error">链接缺少卡号参数（id），请联系客服。</div>';
  } else {
    // 2. 读取 cards.json
    fetch("cards.json")
      .then(res => res.json())
      .then(cards => {
        // 3. 查找对应卡
        const card = cards.find(c => c.card_id === id);

        if (!card) {
          app.innerHTML = '<div class="error">未找到该卡号：<br>' +
                          id +
                          '<br>请确认二维码是否正确。</div>';
          return;
        }

        // 状态样式
        let statusClass = "status--other";
        if (card.status === "未激活") statusClass = "status--unused";
        if (card.status === "已用完" || card.status === "作废") statusClass = "status--used";

        // 4. 渲染卡片
        app.innerHTML = `
          <div class="card">
            <h1>景河泉抵扣卡</h1>
            <div class="id">卡号：${card.card_id}</div>

            <div class="amount">
              ¥${card.amount}<small>面额</small>
            </div>

            <div class="status ${statusClass}">
              <span>${card.status}</span>
            </div>

            <div class="info-row">
              <div class="label">发行日期</div>
              <div class="value">${card.date}</div>
            </div>
            <div class="info-row">
              <div class="label">初始金额</div>
              <div class="value">¥${card.initial}</div>
            </div>
            <div class="info-row">
              <div class="label">当前余额</div>
              <div class="value">¥${card.balance}</div>
            </div>

            <div class="note">
              使用说明：本卡仅限抵扣酒水消费，不找零、不兑换现金。<br>
              备注门店：${card.note || "未填写"}
            </div>
          </div>
        `;
      })
      .catch(err => {
        console.error(err);
        app.innerHTML = '<div class="error">无法加载卡片数据，请稍后再试。</div>';
      });
  }
</script>

</body>
</html>
